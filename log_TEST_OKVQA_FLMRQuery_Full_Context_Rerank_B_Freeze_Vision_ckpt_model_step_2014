[rank: 0] Seed set to 2022
[38;20m[INFO] - runway_for_ml.experiment : Config file saved to experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test/config.json[0m
[38;20m[INFO] - runway_for_ml.experiment : init wandb logger with the following settings: {'entity': 'byrne-lab', 'project': 'PreFLMR MLMI', 'tags': ['OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision', 'test', 'NoBaseModelInfo'], 'id': 'tw54ywcl', 'resume': 'must'}[0m
[38;20m[INFO] - runway_for_ml.data_module.data_pipeline : Using dummy data? False[0m
Could not find image processor class in the image processor config or the model config. Loading based on pattern matching with the model's feature extractor configuration. Please open a PR/issue to update `preprocessor_config.json` to use `image_processor_type` instead of `feature_extractor_type`. This warning will be removed in v4.40.
[38;20m[INFO] - src.data_ops.custom_datasets.vg_datasets : Running PrepareDataloaders[0m
[38;20m[INFO] - src.data_ops.custom_datasets.base_datasets : initialising OKVQADatasetForDPR...[0m
[38;20m[INFO] - src.data_ops.custom_datasets.okvqa_datasets : passages prepared. used 1.239776611328125e-05 secs.[0m
[38;20m[INFO] - src.data_ops.custom_datasets.vg_datasets : [Data Statistics]: test data loader: test/OKVQADatasetForDPR.test 316[0m
The argument `trust_remote_code` is to be used with Auto classes. It has no effect here and is ignored.
The argument `trust_remote_code` is to be used with Auto classes. It has no effect here and is ignored.
[38;20m[INFO] - root : Train with LoRA = False[0m
[38;20m[INFO] - src.executors.Reranker_base_executor : Loading static retrieval results from /home/fz288/rds/hpc-work/PreFLMR/experiments/TEST_OKVQA_FLMR_Index_2/test/_test_OKVQADatasetForDPR.test_predictions_rank_0.pkl[0m
[38;20m[INFO] - src.executors.Reranker_base_executor : Loading static retrieval results from /home/fz288/rds/hpc-work/PreFLMR/experiments/TEST_OKVQA_FLMR_Index/test/_test_OKVQADatasetForDPR.train_predictions_rank_0.pkl[0m
[38;20m[INFO] - src.executors.Reranker_base_executor : Loaded 14055 static retrieval results.[0m
/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/lightning_fabric/connector.py:563: `precision=bf16` is supported for historical reasons but its usage is discouraged. Please set your precision to bf16-mixed instead!
Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[38;20m[INFO] - runway_for_ml.experiment : additional arguments passed to trainer: {'accelerator': 'auto', 'devices': 'auto', 'limit_test_batches': 65, 'precision': 'bf16', 'strategy': 'ddp_find_unused_parameters_true', 'default_root_dir': PosixPath('experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test'), 'logger': [<pytorch_lightning.loggers.tensorboard.TensorBoardLogger object at 0x7f2f8e39ab20>, <pytorch_lightning.loggers.wandb.WandbLogger object at 0x7f2f8e33b430>]}[0m
[31;20m[ERROR] - runway_for_ml.experiment : No checkpoints are specified.[0m
[31;20m[ERROR] - runway_for_ml.experiment : No checkpoint found. Please check your config file.[0m
[31;20m[ERROR] - runway_for_ml.experiment : !!! Testing continues with untrained checkpoints (also useful when applying pre-trained checkpoints directly)[0m
You are using a CUDA device ('NVIDIA A100-SXM4-80GB') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
[rank: 0] Seed set to 2022
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

wandb: Currently logged in as: fz288 (byrne-lab). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in ./wandb/run-20240607_004527-tw54ywcl
wandb: Run `wandb offline` to turn off syncing.
wandb: Resuming run TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014
wandb: ‚≠êÔ∏è View project at https://wandb.ai/byrne-lab/PreFLMR%20MLMI
wandb: üöÄ View run at https://wandb.ai/byrne-lab/PreFLMR%20MLMI/runs/tw54ywcl
[38;20m[INFO] - src.executors.Reranker_base_executor : Preparing 114809 passage data in id2doc...[0m
Runway main started.
input value {} is not a number, parse to string.
Configuration Loaded.
{'args': {'config': 'configs/Rerank/initial_experiments/okvqa_full_context_rerank_B_freeze_vision.jsonnet',
          'experiment_name': 'TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014',
          'from_experiment': '',
          'log_prediction_tables': False,
          'log_prediction_tables_with_images': False,
          'mode': 'test',
          'modules': [],
          'opts': ['train.load_model_path=/home/fz288/rds/hpc-work/PreFLMR/experiments/OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision/train/saved_models/model_step_2014.ckpt'],
          'override': False,
          'reset': False,
          'tags': ['OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision',
                   'test'],
          'test_suffix': '',
          'use_dummy_data': False,
          'wandb_artifacts': 'weizhelin/vqa-images-open/VQAv2-Images:v0'},
 'data_pipeline': {'do_inspect': True,
                   'name': 'MergeDataPipeline',
                   'regenerate': False,
                   'transforms': {'output:PrepareDataloaders': {'cache': True,
                                                                'input_node': ['process:ConcatenatePassageDatasets',
                                                                               'process:WrapOutputIntoKeys'],
                                                                'regenerate': True,
                                                                'setup_kwargs': {'datasets_config': {'test': [{'dataset_type': 'OKVQADatasetForDPR',
                                                                                                               'split': 'test',
                                                                                                               'use_column': 'okvqa_data'}],
                                                                                                     'train': [{'dataset_type': 'OKVQADatasetForDPR',
                                                                                                                'split': 'train',
                                                                                                                'use_column': 'okvqa_data'}],
                                                                                                     'valid': [{'dataset_type': 'OKVQADatasetForDPR',
                                                                                                                'split': 'test',
                                                                                                                'use_column': 'okvqa_data'}]},
                                                                                 'extra_columns': {'passages': 'train_passages',
                                                                                                   'valid_passages': 'valid_passages'},
                                                                                 'feature_extractor_config': {},
                                                                                 'image_processor_config': {'vit_image_processor': {'ImageProcessorClass': 'AutoImageProcessor',
                                                                                                                                    'ImageProcessorModelVersion': 'laion/CLIP-ViT-bigG-14-laion2B-39B-b160k'}},
                                                                                 'pass_columns': {'test_passages': 'test_passages',
                                                                                                  'train_passages': 'train_passages',
                                                                                                  'valid_passages': 'valid_passages',
                                                                                                  'vqa_data_with_dpr_output': 'okvqa_data'},
                                                                                 'tokenizer_config': {'decoder_tokenizer': {'SPECIAL_TOKENS': {'additional_special_tokens': []},
                                                                                                                            'TokenizerClass': 'FLMRContextEncoderTokenizer',
                                                                                                                            'TokenizerModelVersion': 'LinWeizheDragon/PreFLMR_ViT-B'},
                                                                                                      'tokenizer': {'SPECIAL_TOKENS': {'additional_special_tokens': []},
                                                                                                                    'TokenizerClass': 'FLMRQueryEncoderTokenizer',
                                                                                                                    'TokenizerModelVersion': 'LinWeizheDragon/PreFLMR_ViT-B'}}},
                                                                'transform_name': 'PrepareDataloaders'},
                                  'process:ConcatenatePassageDatasets': {'cache': True,
                                                                         'input_node': ['process:LoadOKVQAData'],
                                                                         'regenerate': False,
                                                                         'setup_kwargs': {'concat_splits': {'test_passages': [True],
                                                                                                            'train_passages': [True],
                                                                                                            'valid_passages': [True]},
                                                                                          'names': ['okvqa_passages']},
                                                                         'transform_name': 'ConcatenatePassageDatasets'},
                                  'process:LoadOKVQAData': {'cache': True,
                                                            'regenerate': False,
                                                            'setup_kwargs': {'add_instruction': ['Using '
                                                                                                 'the '
                                                                                                 'provided '
                                                                                                 'image, '
                                                                                                 'obtain '
                                                                                                 'documents '
                                                                                                 'that '
                                                                                                 'address '
                                                                                                 'the '
                                                                                                 'subsequent '
                                                                                                 'question: ',
                                                                                                 'Retrieve '
                                                                                                 'documents '
                                                                                                 'that '
                                                                                                 'provide '
                                                                                                 'an '
                                                                                                 'answer '
                                                                                                 'to '
                                                                                                 'the '
                                                                                                 'question '
                                                                                                 'alongside '
                                                                                                 'the '
                                                                                                 'image: ',
                                                                                                 'Extract '
                                                                                                 'documents '
                                                                                                 'linked '
                                                                                                 'to '
                                                                                                 'the '
                                                                                                 'question '
                                                                                                 'provided '
                                                                                                 'in '
                                                                                                 'conjunction '
                                                                                                 'with '
                                                                                                 'the '
                                                                                                 'image: ',
                                                                                                 'Utilizing '
                                                                                                 'the '
                                                                                                 'given '
                                                                                                 'image, '
                                                                                                 'obtain '
                                                                                                 'documents '
                                                                                                 'that '
                                                                                                 'respond '
                                                                                                 'to '
                                                                                                 'the '
                                                                                                 'following '
                                                                                                 'question: ',
                                                                                                 'Using '
                                                                                                 'the '
                                                                                                 'given '
                                                                                                 'image, '
                                                                                                 'access '
                                                                                                 'documents '
                                                                                                 'that '
                                                                                                 'provide '
                                                                                                 'insights '
                                                                                                 'into '
                                                                                                 'the '
                                                                                                 'following '
                                                                                                 'question: ',
                                                                                                 'Obtain '
                                                                                                 'documents '
                                                                                                 'that '
                                                                                                 'correspond '
                                                                                                 'to '
                                                                                                 'the '
                                                                                                 'inquiry '
                                                                                                 'alongside '
                                                                                                 'the '
                                                                                                 'provided '
                                                                                                 'image: ',
                                                                                                 'With '
                                                                                                 'the '
                                                                                                 'provided '
                                                                                                 'image, '
                                                                                                 'gather '
                                                                                                 'documents '
                                                                                                 'that '
                                                                                                 'offer '
                                                                                                 'a '
                                                                                                 'solution '
                                                                                                 'to '
                                                                                                 'the '
                                                                                                 'question: ',
                                                                                                 'Utilizing '
                                                                                                 'the '
                                                                                                 'given '
                                                                                                 'image, '
                                                                                                 'obtain '
                                                                                                 'documents '
                                                                                                 'that '
                                                                                                 'respond '
                                                                                                 'to '
                                                                                                 'the '
                                                                                                 'following '
                                                                                                 'question: '],
                                                                             'data_path': 'BByrneLab/multi_task_multi_modal_knowledge_retrieval_benchmark_M2KR///OKVQA_data',
                                                                             'image_root_folder': '/home/fz288/rds/rds-cvnlp-hirYTW1FQIw/shared_space/vqa_data/KBVQA_data/ok-vqa',
                                                                             'passage_path': 'BByrneLab/multi_task_multi_modal_knowledge_retrieval_benchmark_M2KR///OKVQA_passages'},
                                                            'transform_name': 'LoadPreprocessedData_v2'},
                                  'process:WrapOutputIntoKeys': {'cache': True,
                                                                 'input_node': ['process:LoadOKVQAData'],
                                                                 'regenerate': True,
                                                                 'setup_kwargs': {'output_keys': ['okvqa_data']},
                                                                 'transform_name': 'WrapOutputIntoKeys'}}},
 'eval': {'eval_op_name': 'Your eval op name'},
 'executor': {'ExecutorClass': 'RerankerBaseExecutor',
              'init_kwargs': {'index_splits': ['train', 'valid', 'test'],
                              'use_data_node': 'output:PrepareDataloaders',
                              'validation_indexing_source': ['okvqa_passages']}},
 'experiment_name': 'TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014',
 'from_experiment': '',
 'log_prediction_tables': False,
 'meta': {'DATA_FOLDER': 'data',
          'EXPERIMENT_FOLDER': 'experiments',
          'TENSORBOARD_FOLDER': 'tensorboards',
          'WANDB': {'CACHE_DIR': 'cache/wandb_cache/',
                    'entity': 'byrne-lab',
                    'project': 'PreFLMR MLMI',
                    'tags': ['OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision',
                             'test']},
          'default_cache_dir': 'cache/',
          'logger_enable': ['tensorboard', 'wandb'],
          'platform_type': 'pytorch',
          'seed': 2022,
          'use_versioning': False},
 'metrics': [{'name': 'compute_rerank_DPR_scores'},
             {'name': 'compute_rerank_DPR_scores_with_pos_ids'}],
 'mode': 'test',
 'model_config': {'Ks': [5, 10, 20, 50, 100],
                  'decoder_input_modules': {'module_list': [{'option': 'default',
                                                             'separation_tokens': {'end': '',
                                                                                   'start': ''},
                                                             'type': 'KnowledgeInput'}],
                                            'postprocess_module_list': [{'option': 'default',
                                                                         'type': 'PostProcessFLMRItemInputTokenization'}]},
                  'docs_to_rerank': 100,
                  'fusion_multiplier': 1,
                  'index_files': {'embedding_path': '',
                                  'index_path': '',
                                  'static_results': ['/home/fz288/rds/hpc-work/PreFLMR/experiments/TEST_OKVQA_FLMR_Index_2/test/_test_OKVQADatasetForDPR.test_predictions_rank_0.pkl',
                                                     '/home/fz288/rds/hpc-work/PreFLMR/experiments/TEST_OKVQA_FLMR_Index/test/_test_OKVQADatasetForDPR.train_predictions_rank_0.pkl']},
                  'input_modules': {'module_list': [{'option': 'from_file',
                                                     'type': 'VisionInput'},
                                                    {'option': 'default',
                                                     'separation_tokens': {'end': '',
                                                                           'start': ''},
                                                     'type': 'InstructionInput'}],
                                    'postprocess_module_list': [{'option': 'default',
                                                                 'type': 'PostProcessVisionInputProcessing'},
                                                                {'option': 'default',
                                                                 'type': 'PostProcessFLMRQuestionInputTokenization'}]},
                  'max_decoder_source_length': 512,
                  'max_source_length': 32,
                  'modules': ['separate_query_and_item_encoders',
                              'full_context_reranker',
                              'freeze_reranker_vision_encoder'],
                  'nbits': 8,
                  'num_negative_samples': 4,
                  'output_modules': {'module_list': [{'option': 'default',
                                                      'type': 'SimilarityOutput'}],
                                     'postprocess_module_list': [{'option': 'default',
                                                                  'type': 'PostProcessConcatenateLabels'}]},
                  'prepend_tokens': {'item_encoder': '', 'query_encoder': ''},
                  'pretrained': 1,
                  'reranker_config': {'RerankerClass': 'FullContextRerankModel',
                                      'base_model': 'FLMR',
                                      'cross_encoder_config_base': 'bert-base-uncased',
                                      'cross_encoder_max_position_embeddings': 750,
                                      'cross_encoder_num_hidden_layers': 1,
                                      'loss_fn': 'BCE',
                                      'max_decoder_source_length': 512,
                                      'max_query_length': 32,
                                      'pretrain_config_class': 'FLMRConfig',
                                      'pretrain_model_version': 'LinWeizheDragon/PreFLMR_ViT-B'},
                  'retriever_config': {'ConfigClass': 'FLMRConfig',
                                       'ModelClass': 'FLMRModelForRetrieval',
                                       'ModelVersion': 'LinWeizheDragon/PreFLMR_ViT-B',
                                       'base_model': 'FLMR'}},
 'override': False,
 'reset': False,
 'test': {'batch_size': 16,
          'checkpoint_name': '',
          'load_best_model': False,
          'load_model_path': '',
          'num_dataloader_workers': 0,
          'trainer_paras': {'accelerator': 'auto',
                            'devices': 'auto',
                            'limit_test_batches': 65,
                            'precision': 'bf16',
                            'strategy': 'ddp_find_unused_parameters_true'}},
 'test_suffix': '',
 'train': {'batch_size': 8,
           'early_stopping_callback_paras': {'mode': 'min',
                                             'patience': 3,
                                             'verbose': True},
           'load_model_path': '/home/fz288/rds/hpc-work/PreFLMR/experiments/OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision/train/saved_models/model_step_2014.ckpt',
           'model_checkpoint_callback_paras': {'auto_insert_metric_name': False,
                                               'filename': 'model_step_{step}',
                                               'mode': 'min',
                                               'monitor': 'valid/OKVQADatasetForDPR.test/loss',
                                               'save_last': True,
                                               'save_on_train_epoch_end': False,
                                               'save_top_k': 5,
                                               'verbose': True},
           'num_dataloader_workers': 4,
           'optimizer_config': {'optimizer_name': 'AdamW',
                                'optimizer_params': {'eps': 1e-08, 'lr': 1e-05},
                                'scheduler': 'none',
                                'scheduler_params': {'num_warmup_steps': 0}},
           'trainer_paras': {'accelerator': 'auto',
                             'accumulate_grad_batches': 8,
                             'check_val_every_n_epoch': None,
                             'devices': 'auto',
                             'limit_val_batches': 50,
                             'log_every_n_steps': 10,
                             'max_epochs': -1,
                             'precision': 'bf16',
                             'strategy': 'ddp_find_unused_parameters_true',
                             'val_check_interval': 1000}},
 'use_dummy_data': False,
 'valid': {'batch_size': 16, 'num_dataloader_workers': 0}}
User modules imported
Runway Testing...
All seeds have been set to 2022
test-directory: experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test
Using loggers: ['tensorboard', 'wandb']
[<pytorch_lightning.loggers.tensorboard.TensorBoardLogger object at 0x7f2f8e39ab20>, <pytorch_lightning.loggers.wandb.WandbLogger object at 0x7f2f8e33b430>]
Saving testing results to: experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test/test_case.txt
======================================================================================================================================================
                                                                     MODEL CONFIG                                                                     
{'Ks': [5, 10, 20, 50, 100], 'decoder_input_modules': {'module_list': [{'option': 'default', 'separation_tokens': {'end': '', 'start': ''}, 'type': 'KnowledgeInput'}], 'postprocess_module_list': [{'option': 'default', 'type': 'PostProcessFLMRItemInputTokenization'}]}, 'docs_to_rerank': 100, 'fusion_multiplier': 1, 'index_files': {'embedding_path': '', 'index_path': '', 'static_results': ['/home/fz288/rds/hpc-work/PreFLMR/experiments/TEST_OKVQA_FLMR_Index_2/test/_test_OKVQADatasetForDPR.test_predictions_rank_0.pkl', '/home/fz288/rds/hpc-work/PreFLMR/experiments/TEST_OKVQA_FLMR_Index/test/_test_OKVQADatasetForDPR.train_predictions_rank_0.pkl']}, 'input_modules': {'module_list': [{'option': 'from_file', 'type': 'VisionInput'}, {'option': 'default', 'separation_tokens': {'end': '', 'start': ''}, 'type': 'InstructionInput'}], 'postprocess_module_list': [{'option': 'default', 'type': 'PostProcessVisionInputProcessing'}, {'option': 'default', 'type': 'PostProcessFLMRQuestionInputTokenization'}]}, 'max_decoder_source_length': 512, 'max_source_length': 32, 'modules': ['separate_query_and_item_encoders', 'full_context_reranker', 'freeze_reranker_vision_encoder'], 'nbits': 8, 'num_negative_samples': 4, 'output_modules': {'module_list': [{'option': 'default', 'type': 'SimilarityOutput'}], 'postprocess_module_list': [{'option': 'default', 'type': 'PostProcessConcatenateLabels'}]}, 'prepend_tokens': {'item_encoder': '', 'query_encoder': ''}, 'pretrained': 1, 'reranker_config': {'RerankerClass': 'FullContextRerankModel', 'base_model': 'FLMR', 'cross_encoder_config_base': 'bert-base-uncased', 'cross_encoder_max_position_embeddings': 750, 'cross_encoder_num_hidden_layers': 1, 'loss_fn': 'BCE', 'max_decoder_source_length': 512, 'max_query_length': 32, 'pretrain_config_class': 'FLMRConfig', 'pretrain_model_version': 'LinWeizheDragon/PreFLMR_ViT-B'}, 'retriever_config': {'ConfigClass': 'FLMRConfig', 'ModelClass': 'FLMRModelForRetrieval', 'ModelVersion': 'LinWeizheDragon/PreFLMR_ViT-B', 'base_model': 'FLMR'}}
======================================================================================================================================================
                                                                   OPTIMIZER CONFIG                                                                   
None
======================================================================================================================================================
                                                                   TRAINING CONFIG                                                                    
{}
======================================================================================================================================================
                                                                     TEST CONFIG                                                                      
{'batch_size': 16, 'checkpoint_name': '', 'load_best_model': False, 'load_model_path': '', 'num_dataloader_workers': 0, 'trainer_paras': {'accelerator': 'auto', 'devices': 'auto', 'limit_test_batches': 65, 'precision': 'bf16', 'strategy': 'ddp_find_unused_parameters_true'}}
======================================================================================================================================================
PrepareDataloaders
{'cache': True, 'input_node': ['process:ConcatenatePassageDatasets', 'process:WrapOutputIntoKeys'], 'regenerate': True, 'setup_kwargs': {'datasets_config': {'test': [{'dataset_type': 'OKVQADatasetForDPR', 'split': 'test', 'use_column': 'okvqa_data'}], 'train': [{'dataset_type': 'OKVQADatasetForDPR', 'split': 'train', 'use_column': 'okvqa_data'}], 'valid': [{'dataset_type': 'OKVQADatasetForDPR', 'split': 'test', 'use_column': 'okvqa_data'}]}, 'extra_columns': {'passages': 'train_passages', 'valid_passages': 'valid_passages'}, 'feature_extractor_config': {}, 'image_processor_config': {'vit_image_processor': {'ImageProcessorClass': 'AutoImageProcessor', 'ImageProcessorModelVersion': 'laion/CLIP-ViT-bigG-14-laion2B-39B-b160k'}}, 'pass_columns': {'test_passages': 'test_passages', 'train_passages': 'train_passages', 'valid_passages': 'valid_passages', 'vqa_data_with_dpr_output': 'okvqa_data'}, 'tokenizer_config': {'decoder_tokenizer': {'SPECIAL_TOKENS': {'additional_special_tokens': []}, 'TokenizerClass': 'FLMRContextEncoderTokenizer', 'TokenizerModelVersion': 'LinWeizheDragon/PreFLMR_ViT-B'}, 'tokenizer': {'SPECIAL_TOKENS': {'additional_special_tokens': []}, 'TokenizerClass': 'FLMRQueryEncoderTokenizer', 'TokenizerModelVersion': 'LinWeizheDragon/PreFLMR_ViT-B'}}}, 'transform_name': 'PrepareDataloaders'}
dict_keys([])
attempting to check cache exist: cache/process:ConcatenatePassageDatasets-4c3114b2ec6656f111735f2284653362.hf --> True
attempting to check cache exist: cache/process:LoadOKVQAData-f810a301c4921c239584cdd5426ec7ac.hf --> True
Load process:ConcatenatePassageDatasets-4c3114b2ec6656f111735f2284653362 from disk cache
Data loaded from cache/process:ConcatenatePassageDatasets-4c3114b2ec6656f111735f2284653362.hf
WrapOutputIntoKeys
{'cache': True, 'input_node': ['process:LoadOKVQAData'], 'regenerate': True, 'setup_kwargs': {'output_keys': ['okvqa_data']}, 'transform_name': 'WrapOutputIntoKeys'}
dict_keys([])
Load process:LoadOKVQAData-f810a301c4921c239584cdd5426ec7ac from disk cache
Data loaded from cache/process:LoadOKVQAData-f810a301c4921c239584cdd5426ec7ac.hf
Node: process:WrapOutputIntoKeys 
Execute Transform: WrapOutputIntoKeys
wrapped columns: dict_keys(['okvqa_data'])
Data saved to cache/process:WrapOutputIntoKeys-d736da6bd13f28721d585150bcfd0db6.pkl
Node: output:PrepareDataloaders 
Execute Transform: PrepareDataloaders
Received data columns: dict_keys(['test_passages', 'train_passages', 'valid_passages', 'okvqa_data'])
test_passages: Dataset({
    features: ['passage_id', 'passage_content', 'title', 'source_name'],
    num_rows: 114809
})
train_passages: Dataset({
    features: ['passage_id', 'passage_content', 'title', 'source_name'],
    num_rows: 114809
})
valid_passages: Dataset({
    features: ['passage_id', 'passage_content', 'title', 'source_name'],
    num_rows: 114809
})
okvqa_data: {'train': Dataset({
    features: ['answers', 'gold_answer', 'question', 'question_id', 'img_path', 'img_key_full', 'img_key', 'img_file_name', 'img', 'img_caption', 'objects', 'img_ocr', 'pos_item_ids', 'pos_item_contents', 'related_item_ids', '__index_level_0__', 'instruction'],
    num_rows: 9009
}), 'valid': Dataset({
    features: ['answers', 'gold_answer', 'question', 'question_id', 'img_path', 'img_key_full', 'img_key', 'img_file_name', 'img', 'img_caption', 'objects', 'img_ocr', 'pos_item_ids', 'pos_item_contents', 'related_item_ids', '__index_level_0__', 'instruction'],
    num_rows: 5046
}), 'test': Dataset({
    features: ['answers', 'gold_answer', 'question', 'question_id', 'img_path', 'img_key_full', 'img_key', 'img_file_name', 'img', 'img_caption', 'objects', 'img_ocr', 'pos_item_ids', 'pos_item_contents', 'related_item_ids', '__index_level_0__', 'instruction'],
    num_rows: 5046
}), 'train_passages': Dataset({
    features: ['passage_id', 'passage_content', 'title'],
    num_rows: 114809
}), 'valid_passages': Dataset({
    features: ['passage_id', 'passage_content', 'title'],
    num_rows: 114809
}), 'test_passages': Dataset({
    features: ['passage_id', 'passage_content', 'title'],
    num_rows: 114809
})}
'Dataset' object has no attribute 'keys'
'Dataset' object has no attribute 'keys'
'Dataset' object has no attribute 'keys'
First 5 image paths in dataset 'okvqa_data[train]' of length 9009 are valid.
First 5 image paths in dataset 'okvqa_data[valid]' of length 5046 are valid.
First 5 image paths in dataset 'okvqa_data[test]' of length 5046 are valid.
'img_path'
extra_column passages extra_column_from train_passages
extra_column valid_passages extra_column_from valid_passages
available ids 114809
{'test_passages': 'test_passages', 'train_passages': 'train_passages', 'valid_passages': 'valid_passages', 'vqa_data_with_dpr_output': 'okvqa_data'}
Data saved to cache/output:PrepareDataloaders-dc03d5b49c83f6684ace8dfcc369d2bf.pkl
Freezing Reranker vision encoders
Load output:PrepareDataloaders-dc03d5b49c83f6684ace8dfcc369d2bf from program cache
Load output:PrepareDataloaders-dc03d5b49c83f6684ace8dfcc369d2bf from program cache
0
Loading lookup table...
Rank 0 Done loading lookup table.
formatting the test passages:   0%|          | 0/114809 [00:00<?, ?it/s]formatting the test passages:   2%|‚ñè         | 1950/114809 [00:00<00:05, 19491.33it/s]formatting the test passages:   3%|‚ñé         | 3994/114809 [00:00<00:05, 20048.30it/s]formatting the test passages:   5%|‚ñå         | 6047/114809 [00:00<00:05, 20267.90it/s]formatting the test passages:   7%|‚ñã         | 8092/114809 [00:00<00:05, 20338.74it/s]formatting the test passages:   9%|‚ñâ         | 10142/114809 [00:00<00:05, 20395.11it/s]formatting the test passages:  11%|‚ñà         | 12206/114809 [00:00<00:05, 20478.22it/s]formatting the test passages:  12%|‚ñà‚ñè        | 14272/114809 [00:00<00:04, 20535.95it/s]formatting the test passages:  14%|‚ñà‚ñç        | 16328/114809 [00:00<00:04, 20543.35it/s]formatting the test passages:  16%|‚ñà‚ñå        | 18384/114809 [00:00<00:04, 20547.92it/s]formatting the test passages:  18%|‚ñà‚ñä        | 20439/114809 [00:01<00:04, 20545.56it/s]formatting the test passages:  20%|‚ñà‚ñâ        | 22494/114809 [00:01<00:04, 20508.14it/s]formatting the test passages:  21%|‚ñà‚ñà‚ñè       | 24545/114809 [00:01<00:04, 20466.48it/s]formatting the test passages:  23%|‚ñà‚ñà‚ñé       | 26607/114809 [00:01<00:04, 20511.05it/s]formatting the test passages:  25%|‚ñà‚ñà‚ñç       | 28664/114809 [00:01<00:04, 20528.13it/s]formatting the test passages:  27%|‚ñà‚ñà‚ñã       | 30721/114809 [00:01<00:04, 20539.87it/s]formatting the test passages:  29%|‚ñà‚ñà‚ñä       | 32786/114809 [00:01<00:03, 20570.79it/s]formatting the test passages:  30%|‚ñà‚ñà‚ñà       | 34844/114809 [00:01<00:03, 20553.15it/s]formatting the test passages:  32%|‚ñà‚ñà‚ñà‚ñè      | 36900/114809 [00:01<00:03, 20517.14it/s]formatting the test passages:  34%|‚ñà‚ñà‚ñà‚ñç      | 38961/114809 [00:01<00:03, 20542.16it/s]formatting the test passages:  36%|‚ñà‚ñà‚ñà‚ñå      | 41018/114809 [00:02<00:03, 20549.48it/s]formatting the test passages:  38%|‚ñà‚ñà‚ñà‚ñä      | 43073/114809 [00:02<00:03, 20531.14it/s]formatting the test passages:  39%|‚ñà‚ñà‚ñà‚ñâ      | 45127/114809 [00:02<00:03, 20412.12it/s]formatting the test passages:  41%|‚ñà‚ñà‚ñà‚ñà      | 47183/114809 [00:02<00:03, 20454.67it/s]formatting the test passages:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 49233/114809 [00:02<00:03, 20466.71it/s]formatting the test passages:  45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 51283/114809 [00:02<00:03, 20474.52it/s]formatting the test passages:  46%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 53350/114809 [00:02<00:02, 20531.42it/s]formatting the test passages:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 55410/114809 [00:02<00:02, 20549.58it/s]formatting the test passages:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 57469/114809 [00:02<00:02, 20559.88it/s]formatting the test passages:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 59533/114809 [00:02<00:02, 20581.62it/s]formatting the test passages:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 61594/114809 [00:03<00:02, 20589.59it/s]formatting the test passages:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 63662/114809 [00:03<00:02, 20613.82it/s]formatting the test passages:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 65729/114809 [00:03<00:02, 20627.58it/s]formatting the test passages:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 67799/114809 [00:03<00:02, 20647.22it/s]formatting the test passages:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 69864/114809 [00:03<00:02, 20610.64it/s]formatting the test passages:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 71926/114809 [00:03<00:02, 20543.13it/s]formatting the test passages:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 73981/114809 [00:03<00:01, 20533.44it/s]formatting the test passages:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 76035/114809 [00:03<00:01, 20501.95it/s]formatting the test passages:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 78091/114809 [00:03<00:01, 20517.63it/s]formatting the test passages:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 80145/114809 [00:03<00:01, 20521.74it/s]formatting the test passages:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 82198/114809 [00:04<00:01, 20498.85it/s]formatting the test passages:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 84248/114809 [00:04<00:01, 20482.90it/s]formatting the test passages:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 86297/114809 [00:04<00:01, 20475.94it/s]formatting the test passages:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 88345/114809 [00:04<00:01, 20241.16it/s]formatting the test passages:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 90393/114809 [00:04<00:01, 20309.98it/s]formatting the test passages:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 92452/114809 [00:04<00:01, 20391.51it/s]formatting the test passages:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 94507/114809 [00:04<00:00, 20437.36it/s]formatting the test passages:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 96561/114809 [00:04<00:00, 20465.97it/s]formatting the test passages:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 98618/114809 [00:04<00:00, 20496.61it/s]formatting the test passages:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 100680/114809 [00:04<00:00, 20530.89it/s]formatting the test passages:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 102735/114809 [00:05<00:00, 20536.50it/s]formatting the test passages:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 104789/114809 [00:05<00:00, 20470.51it/s]formatting the test passages:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 106837/114809 [00:05<00:00, 20417.65it/s]formatting the test passages:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 108879/114809 [00:05<00:00, 20368.76it/s]formatting the test passages:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 110940/114809 [00:05<00:00, 20439.37it/s]formatting the test passages:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 112992/114809 [00:05<00:00, 20463.07it/s]formatting the test passages: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 114809/114809 [00:05<00:00, 20484.41it/s]
[38;20m[INFO] - src.executors.Reranker_base_executor : passages from the source okvqa_passages has 114809[0m
[38;20m[INFO] - src.executors.Reranker_base_executor : Passages prepared.[0m
[38;20m[INFO] - src.executors.Reranker_base_executor : tokenizer lengths = 30522 and 30522[0m
[38;20m[INFO] - src.executors.Reranker_base_executor : Loading from /home/fz288/rds/hpc-work/PreFLMR/experiments/OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision/train/saved_models/model_step_2014.ckpt[0m
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
SLURM auto-requeueing enabled. Setting signal handlers.
/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/pytorch_lightning/trainer/connectors/data_connector.py:441: The 'test_dataloader' does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` to `num_workers=31` in the `DataLoader` to improve performance.
Testing: |          | 0/? [00:00<?, ?it/s]Testing:   0%|          | 0/65 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/65 [00:00<?, ?it/s]Testing DataLoader 0:   2%|‚ñè         | 1/65 [00:00<00:47,  1.35it/s]Testing DataLoader 0:   3%|‚ñé         | 2/65 [00:01<01:02,  1.01it/s]Testing DataLoader 0:   5%|‚ñç         | 3/65 [00:03<01:06,  0.94it/s]Testing DataLoader 0:   6%|‚ñå         | 4/65 [00:04<01:07,  0.90it/s]Testing DataLoader 0:   8%|‚ñä         | 5/65 [00:05<01:07,  0.88it/s]Testing DataLoader 0:   9%|‚ñâ         | 6/65 [00:06<01:07,  0.87it/s]Testing DataLoader 0:  11%|‚ñà         | 7/65 [00:08<01:07,  0.86it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 8/65 [00:09<01:06,  0.86it/s]Testing DataLoader 0:  14%|‚ñà‚ñç        | 9/65 [00:10<01:05,  0.85it/s]Testing DataLoader 0:  15%|‚ñà‚ñå        | 10/65 [00:11<01:04,  0.85it/s]Testing DataLoader 0:  17%|‚ñà‚ñã        | 11/65 [00:13<01:03,  0.84it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 12/65 [00:14<01:02,  0.84it/s]Testing DataLoader 0:  20%|‚ñà‚ñà        | 13/65 [00:15<01:01,  0.84it/s]Testing DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 14/65 [00:16<01:00,  0.84it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 15/65 [00:17<00:59,  0.84it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñç       | 16/65 [00:19<00:58,  0.83it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 17/65 [00:20<00:57,  0.83it/s]Testing DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 18/65 [00:21<00:56,  0.83it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñâ       | 19/65 [00:22<00:55,  0.83it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà       | 20/65 [00:24<00:54,  0.83it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 21/65 [00:25<00:53,  0.83it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñç      | 22/65 [00:26<00:51,  0.83it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñå      | 23/65 [00:27<00:50,  0.83it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 24/65 [00:29<00:49,  0.83it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 25/65 [00:30<00:48,  0.83it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñà      | 26/65 [00:31<00:47,  0.83it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 27/65 [00:32<00:46,  0.83it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 28/65 [00:33<00:44,  0.83it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 29/65 [00:35<00:43,  0.82it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 30/65 [00:36<00:42,  0.82it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 31/65 [00:37<00:41,  0.82it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 32/65 [00:38<00:40,  0.82it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 33/65 [00:40<00:38,  0.82it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 34/65 [00:41<00:37,  0.82it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 35/65 [00:42<00:36,  0.82it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 36/65 [00:43<00:35,  0.82it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 37/65 [00:44<00:34,  0.82it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 38/65 [00:46<00:32,  0.82it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 39/65 [00:47<00:31,  0.82it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 40/65 [00:48<00:30,  0.82it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 41/65 [00:49<00:29,  0.82it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 42/65 [00:51<00:28,  0.82it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 43/65 [00:52<00:26,  0.82it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 44/65 [00:53<00:25,  0.82it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 45/65 [00:54<00:24,  0.82it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 46/65 [00:56<00:23,  0.82it/s]Testing DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 47/65 [00:57<00:21,  0.82it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 48/65 [00:58<00:20,  0.82it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 49/65 [00:59<00:19,  0.82it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 50/65 [01:00<00:18,  0.82it/s]Testing DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 51/65 [01:02<00:17,  0.82it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 52/65 [01:03<00:15,  0.82it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 53/65 [01:05<00:14,  0.82it/s]Testing DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 54/65 [01:06<00:13,  0.82it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 55/65 [01:07<00:12,  0.82it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 56/65 [01:08<00:11,  0.81it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 57/65 [01:09<00:09,  0.81it/s]Testing DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 58/65 [01:11<00:08,  0.81it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 59/65 [01:12<00:07,  0.81it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 60/65 [01:13<00:06,  0.81it/s]Testing DataLoader 0:  94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 61/65 [01:14<00:04,  0.81it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 62/65 [01:16<00:03,  0.81it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 63/65 [01:17<00:02,  0.81it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 64/65 [01:18<00:01,  0.81it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 65/65 [01:19<00:00,  0.81it/s]/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/pytorch_lightning/utilities/data.py:77: Trying to infer the `batch_size` from an ambiguous collection. The batch size we found is 16. To avoid any miscalculations, use `self.log(..., batch_size=batch_size)`.
[38;20m[INFO] - src.executors.Reranker_base_executor : reading global step of the checkpoint...[0m
[38;20m[INFO] - src.executors.Reranker_base_executor : Evaluation results [test]: {'_test/OKVQADatasetForDPR.test/loss': 0.23206086456775665, '_test/OKVQADatasetForDPR.test/epoch': 0}[0m
{'_test/OKVQADatasetForDPR.test/epoch': 0,
 '_test/OKVQADatasetForDPR.test/loss': 0.23206086456775665}
{'predictions/step_0_MODE(test)_SET(_test/OKVQADatasetForDPR.test)_rank(0)': <wandb.data_types.Table object at 0x7f2feb5fa160>}
Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 65/65 [01:20<00:00,  0.81it/s][38;20m[INFO] - runway_for_ml.utils.eval_recorder : test-evaluation EvalRecorder saved to experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test/test-evaluation/eval_recorder-sample_log.json, experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test/test-evaluation/eval_recorder-stats_log.json, experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test/test-evaluation/eval_recorder-meta_config.json[0m

Test evaluation recorder saved to experiments/TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014/test/test-evaluation
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            Test metric                       DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
_test/OKVQADatasetForDPR.test/epoch                0.0
_test/OKVQADatasetForDPR.test/loss         0.23206086456775665
         valid/loss_epoch                  0.23206086456775665
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
wandb: - 0.000 MB of 0.000 MB uploadedwandb: \ 0.000 MB of 0.036 MB uploadedwandb: | 0.000 MB of 0.036 MB uploadedwandb: / 0.036 MB of 0.036 MB uploadedwandb: 
wandb: Run history:
wandb:               epoch ‚ñÅ
wandb: trainer/global_step ‚ñÅ‚ñÅ‚ñÅ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÇ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñÜ‚ñá‚ñá‚ñá‚ñá‚ñá‚ñá‚ñà‚ñà‚ñà‚ñÅ
wandb:    valid/loss_epoch ‚ñÅ
wandb:     valid/loss_step ‚ñÑ‚ñÅ‚ñÑ‚ñá‚ñÉ‚ñÉ‚ñÑ‚ñÇ‚ñÉ‚ñÑ‚ñÜ‚ñÑ‚ñÖ‚ñÜ‚ñÑ‚ñà‚ñÉ‚ñÜ‚ñÖ‚ñÉ‚ñÑ‚ñÖ‚ñÉ‚ñá‚ñÉ‚ñá‚ñÑ‚ñÜ‚ñá‚ñÉ‚ñÖ‚ñÉ‚ñÇ‚ñÖ‚ñÉ‚ñÜ‚ñÖ‚ñÑ‚ñÑ‚ñÖ
wandb: 
wandb: Run summary:
wandb:               epoch 0
wandb: trainer/global_step 0
wandb:    valid/loss_epoch 0.23206
wandb:     valid/loss_step 0.24796
wandb: 
wandb: üöÄ View run TEST_OKVQA_FLMRQuery_Full_Context_Rerank_B_Freeze_Vision_ckpt_model_step_2014 at: https://wandb.ai/byrne-lab/PreFLMR%20MLMI/runs/tw54ywcl
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/byrne-lab/PreFLMR%20MLMI
wandb: Synced 4 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240607_004527-tw54ywcl/logs
Exception in thread IntMsgThr:
Traceback (most recent call last):
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/threading.py", line 932, in _bootstrap_inner
Exception in thread NetStatThr:
Traceback (most recent call last):
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/threading.py", line 870, in run
    self.run()
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/wandb_run.py", line 300, in check_internal_messages
    self._target(*self._args, **self._kwargs)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/wandb_run.py", line 268, in check_network_status
    self._loop_check_status(
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/wandb_run.py", line 224, in _loop_check_status
    self._loop_check_status(
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/wandb_run.py", line 224, in _loop_check_status
    local_handle = request()
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface.py", line 856, in deliver_internal_messages
    local_handle = request()
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface.py", line 848, in deliver_network_status
    return self._deliver_internal_messages(internal_message)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface_shared.py", line 516, in _deliver_internal_messages
    return self._deliver_network_status(status)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface_shared.py", line 510, in _deliver_network_status
    return self._deliver_record(record)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface_shared.py", line 459, in _deliver_record
    return self._deliver_record(record)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface_shared.py", line 459, in _deliver_record
    handle = mailbox._deliver_record(record, interface=self)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/mailbox.py", line 455, in _deliver_record
    handle = mailbox._deliver_record(record, interface=self)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/mailbox.py", line 455, in _deliver_record
    interface._publish(record)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface_sock.py", line 51, in _publish
    interface._publish(record)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/interface/interface_sock.py", line 51, in _publish
    self._sock_client.send_record_publish(record)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 221, in send_record_publish
    self._sock_client.send_record_publish(record)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 221, in send_record_publish
    self.send_server_request(server_req)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 155, in send_server_request
    self.send_server_request(server_req)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 155, in send_server_request
    self._send_message(msg)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 152, in _send_message
    self._send_message(msg)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 152, in _send_message
    self._sendall_with_error_handle(header + data)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 130, in _sendall_with_error_handle
    self._sendall_with_error_handle(header + data)
  File "/home/fz288/rds/hpc-work/PreFLMR/VQA/lib/python3.8/site-packages/wandb/sdk/lib/sock_client.py", line 130, in _sendall_with_error_handle
    sent = self._sock.send(data)
BrokenPipeError: [Errno 32] Broken pipe
    sent = self._sock.send(data)
BrokenPipeError: [Errno 32] Broken pipe
